<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>An Online B2B market——-Shoestp.com,gathering 300 professional shoes manufacture companies Business backstage</title>
    <script src="../../static/admin/js/jquery-1.11.1.js" type="text/javascript" charset="utf-8"></script>
    <script src="/seller/static/admin/layui/lay/dest/layui.all.js" type="text/javascript" charset="utf-8"></script>
    <!--<script src="../../static/admin/js/common.js" type="text/javascript" charset="utf-8"></script>-->
    <link rel="stylesheet" type="text/css" href="../../static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../../static/admin/css/admin.css"/>
    <style>
        /*标题文字 */
        .layui-card-header {
            padding-left: 30px;
            font-size: 17px;
        }

        /*两个form之间 border格掉 */
        .bb1 {
            margin-bottom: 20px;
            border-bottom: 1px solid #5FB878;
        }

        /*form 左label大小*/
        .layui-form-label {
            width: 150px;
            white-space: nowrap;
        }

        /*form 右 大小*/
        .layui-input-block {
            margin-left: 180px;
        }

        .layui-card-body {
            padding-left: 20px;
        }

        /*form 左label大小*/
        .small-input-wrap {
            width: 190px;
        }
    </style>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>支付设置</legend>
</fieldset>
<div class="min-width1200" style="padding: 15px">
    <form class="layui-form" lay-filter="form_OFFINE_PAY">
        <div class="layui-col-md12">
            <div class="layui-card" id="offline_pay">
                <div class="layui-card-header">现金支付</div>
                <div class="layui-card-body">
                    <div class="layui-form-item">
                        <label class="layui-form-label">启用</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="enabled" lay-skin="switch" lay-filter="open"
                                   lay-text="ON|OFF">
                        </div>
                    </div>
                    <div class="setting bb1" style="display: none">
                        <input type="hidden" name="mode" value="OFFINE_PAY"/>
                        <input type="hidden" name="pkey" value="-1"/>
                        <div class="layui-form-item" style=" display: none;">
                            <label class="layui-form-label">手续费</label>
                            <div class="layui-input-inline small-input-wrap">
                                <input type="number" min="0" name="poundage" value="0" placeholder="￥"
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item" style=" display: none;">
                            <label class="layui-form-label">附加费用</label>
                            <div class="layui-input-inline small-input-wrap">
                                <input type="number" name="extra_costs" placeholder="￥" min="0"
                                       autocomplete="off"
                                       value="0"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">结算开户人</label>
                            <div class="layui-input-block">
                                <input type="text" name="account_name" lay-verify="account_name" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">银行账户</label>
                            <div class="layui-input-block">
                                <input type="text" name="bank_account" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">开户银行支行名称</label>
                            <div class="layui-input-block">
                                <input type="text" name="depos_it_bank_subbranch" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">开户银行支行所在地</label>
                            <div class="layui-input-block">
                                <input type="text" name="depos_it_bank_subbranch_ascription" class="layui-input"
                                       placeholder="请输入"
                                >
                                <!--<select class="quiz">-->
                                <!--<option value="">请选择省</option>-->
                                <!--<option value="浙江" selected="">浙江省</option>-->
                                <!--<option value="你的工号">江西省</option>-->
                                <!--<option value="你最喜欢的老师">福建省</option>-->
                                <!--</select>-->
                            </div>
                            <!--<div class="layui-input-inline">-->
                            <!--<select class="quiz">-->
                            <!--<option value="">请选择市</option>-->
                            <!--<option value="杭州">杭州</option>-->
                            <!--<option value="宁波" disabled="">宁波</option>-->
                            <!--<option value="温州">温州</option>-->
                            <!--<option value="温州">台州</option>-->
                            <!--<option value="温州">绍兴</option>-->
                            <!--</select>-->
                            <!--</div>-->
                            <!--<div class="layui-input-inline">-->
                            <!--<select class="quiz">-->
                            <!--<option value="">请选择县/区</option>-->
                            <!--<option value="西湖区">西湖区</option>-->
                            <!--<option value="余杭区">余杭区</option>-->
                            <!--<option value="拱墅区">临安市</option>-->
                            <!--</select>-->
                            <!--</div>-->
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </form>

    <form class="layui-form" lay-filter="form_TTPAY" id="TTForm">
        <div class="layui-col-md12">
            <div class="layui-card" id="ttpay">
                <div class="layui-card-header">TT支付</div>
                <div class="layui-card-body">
                    <div class="layui-form-item">
                        <label class="layui-form-label">启用</label>
                        <div class="layui-input-block">
                            <input type="checkbox" name="enabled" lay-skin="switch" lay-filter="open"
                                   lay-text="ON|OFF">
                        </div>
                    </div>
                    <div class="setting" style="display: none">
                        <input type="hidden" name="mode" value="TTPAY"/>
                        <input type="hidden" name="pkey" value="-1"/>

                        <div class="layui-form-item" style=" display: none;">
                            <label class="layui-form-label">手续费</label>
                            <div class="layui-input-inline small-input-wrap">
                                <input type="number" name="poundage" min="0" value="0" placeholder="￥"
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none;">
                            <label class="layui-form-label">附加费用</label>
                            <div class="layui-input-inline small-input-wrap">
                                <input type="number" name="extra_costs" placeholder="￥" value="0" min="0"
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">BENEFICIARY BANK</label>
                            <div class="layui-input-block">
                                <input type="text" name="beneficiarybank" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">SWIFT CODE</label>
                            <div class="layui-input-block">
                                <input type="text" name="swiftcode" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">BENEFICIARY</label>
                            <div class="layui-input-block">
                                <input type="text" name="brneficiary" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">BANK Address</label>
                            <div class="layui-input-block">
                                <input type="text" name="bankaddress" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">BENEFICIARY ACCOUNT</label>
                            <div class="layui-input-block">
                                <input type="text" name="beneficiaryaccount" autocomplete="off"
                                       placeholder="请输入"
                                       class="layui-input">
                            </div>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="layui-form-item">
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button class="layui-btn" id="submit">提交</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </form>
</div>
<script>
    layui.use(['form'], function () {
        var form = layui.form;
        $.ajax({
            url: "/seller/plt_PltPay_getPaySettings",
            type: "get",
            dataType: "json",
            success: function (data) {
                if (data != null)
                    if (data.toString().length > 4) {
                        $.each(data, function (i, v) {
                            console.log(v.mode)
                            switch (v.mode) {
                                case 5:
                                    v.mode = "OFFINE_PAY"
                                    break
                                case 10:
                                    v.mode = "TTPAY"
                                    break;
                            }
                            form.val("form_" + v.mode, v)
                            form.render();
                            $("div.layui-card").each(function () {
                                var en = $("input[type='checkbox']", this).prop("checked");
                                if (!en) {
                                    $("div.setting", this).hide()
                                } else {
                                    $("div.setting", this).show()
                                }
                            })
                        })
                    } else {
                        form.val("form_OFFINE_PAY", {})
                        form.val("form_TTPAY", {})
                    }
                form.on('switch(open)', function (data) {
                    if (data.elem.checked) {
                        $("div.setting", $(this).parent().parent().parent()).show()
                    } else {
                        $("div.setting", $(this).parent().parent().parent()).hide()
                    }
                });

            }
        })


    });
    var lastDate = new Date();

    function validate(d) {
        if (!$(d).val().length > 0) {
            if ((new Date - lastDate) > 1000) {
                // if ($(this).parent().parent()) {
                //     alert($("label", $(this).parent().parent()).text() + "不能为空")
                //
                // } else {
                //     alert("存在不合法值")
                // }

                $(d).css({
                    "border": "red 1px solid"
                })
                lastDate = new Date();
            }
            return 1
        } else {
            $(d).removeAttr("style")
            return 0;
        }
    }


    $(document).ready(function () {

        $("input[name]", $("div.setting")).each(function () {
            if ($(this).attr("name").length > 0) {
                $(this).attr("disabled")
                $(this).on("blur", function () {
                    validate(this)
                })
            }
        })

        $("#submit").on("click", function () {
            var data = []
            var address = "";
            var post = 0;
            $("input[name='depos_it_bank_subbranch_ascription'][type='hidden']").val(address);
            $("div.layui-card").each(function () {
                json = {}
                var en = $("input[type='checkbox']", this).prop("checked");
                json["enabled"] = en;
                $("input[name]", $("div.setting", this)).each(function () {
                    if ($(this).attr("name").length > 0) {
                        json[$(this).attr("name")] = $(this).val();
                        if (en) {
                            post += validate(this);

                        }
                    }
                })
                data.push(json);
            })
            if (post == 0) {
                $.ajax({
                    url: "/seller/plt_PltPay_savePaySetting",
                    data: {
                        paySetting: JSON.stringify(data)
                    },
                    type: "POST",
                    dataType: "Json",
                    success: function (data) {
                        layer.msg("提交成功", {time: 3000});
                    }, error: function () {
                        layer.msg("提交失败", {time: 3000});
                    }
                })
            }
            return false;
        })
    })

</script>
</body>
</html>